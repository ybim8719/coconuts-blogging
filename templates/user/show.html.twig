{% extends 'base.html.twig' %}

{% block title %} {{ user.username }} {% endblock %}

{% block body %}
    <div class ="coconuts-story-container">
        <h1>Profil de {{ user.username }} </h1>
        <table class="table table-info">
            <tbody>
                <tr>
                    <th>Inscrit depuis le :</th>
                    <td>{{user.createdAt|date("m/d/Y")}}</td>
                </tr>
                <tr>
                    <th>Username</th>
                    <td>
                        {{ user.username }}      
                        <img src="{{ vich_uploader_asset(user) }}" alt="{{ user.username }}" 
                             class="coconuts-round-picture small-img" />
                    </td>
                </tr>
                <tr>
                    <th>Email</th>
                    <td>{{ user.email }}</td>
                </tr>
                <tr>
                    <th>Est administrateur</th>
                    <td>{{ user.isAdmin ? 'Yes' : 'No' }}</td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>{{ user.profileDescription }}</td>
                </tr>
                <tr>
                    <th>Abonnements</th>
                    <td>{{user.nbOfSubscribedFollows}} </td>
                </tr>
                <tr>
                    <th>Abonnés</th>
                    <td>{{user.nbOfIncomingFollows}}</td>
                </tr>
                <tr>
                    <th>Articles écrits</th>
                    <td>{{user.nbOfArticles}}</td>
                </tr>
                <tr>
                    <th>Actions</th>
                    <td>
                        <button class="coconuts_follow_writer button-block" {% if app.user is null %} disabled
                        {% else %} data-id ={{app.user.id}} {% endif %}>
                            Follow
                        </button>
                    </td>
                </tr>

            </tbody>
        </table>

        <div class="w3-bar w3-black">
            <button class="w3-bar-item w3-button" onclick="openCategory('articles')">Articles</button>
            <button class="w3-bar-item w3-button" onclick="openCategory('commentaires')">Commentaires</button>
            <button class="w3-bar-item w3-button" onclick="openCategory('likes')">Likes</button>
        </div>

        <div id="articles" class="category">
            {% if user.articles is not null %}
                <div class= "row">
                    {% for article in user.articles %}
                        <div class="card col-4" style="width: 18rem;">
                            <img class="card-img-top" src ="{{ vich_uploader_asset(article) }}" alt="{{ article.title }}" height="100">
                            <div class="card-body">
                                <h5 class="card-title">{{article.title}}</h5>
                                <p class="card-text">{{article.description|striptags|slice(0, 200)}}</p>
                                <a href="{{ path('article_show', {'id': article.id})}}" class="btn btn-primary">LIRE</a>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        </div>

        <div id="commentaires" class="category" style="display:none">
            {% if user.publishedComments is not empty %}
                <div class="row">
                    {% for comment in user.publishedComments %}
                        <div class="card col-4" style="width: 18rem;">
                            <div class="card-body">
                                <p class="card-text">{{comment.content}}</p>
                                <a href="{{ path('articleComment_show', {'idComment': comment.id})}}" class="btn btn-primary">LIRE</a>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        </div>

        <div id="likes" class="category" style="display:none">
            {% if user.publishedLikes is not null %}
                <div class= "row">
                    {% for like in user.publishedLikes %}
                        <div class="card col-4" style="width: 18rem;">
                            {% if like.isLikeAppliedOnComment %}
                                <div class="card-body">
                                    <img class="card-img-top"
                                         src ="{{ vich_uploader_asset(like.likedArticle) }}"
                                         alt="{{ like.likedArticle.title }}"
                                         height="100"
                                    >
                                    <h5 class="card-title">{{ like.likedArticle.title }}</h5>
                                    <p class="card-text">{{ like.likedArticle.chapeau|striptags|slice(0, 200) }}</p>
                                    <a href="{{ path('article_show', {'id': like.likedArticle.id})}}" class="btn btn-primary">
                                        LIRE
                                    </a>
                                    <img src ="{{ vich_uploader_asset(like.likedArticle.user) }}"
                                         alt="{{ like.likedArticle.user.username }}"
                                         height="100"
                                         class ="coconuts-round-picture rikiki-img"
                                    >
                                </div>
                            {% else %}

                            {% endif %}
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        </div>

        <div class= "row">
            <a href="{{ path('user_index')}}">
                <input type="button" value="Retour à la liste" />
            </a>
               <a href="{{ path('user_edit', {'id': user.id})}}">
                <input type="button" value="Modifier" />
            </a>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        function openCategory(category) {
            var i;
            var x = document.getElementsByClassName("category");
            for (i = 0; i < x.length; i++) {
                x[i].style.display = "none";
            }
            document.getElementById(category).style.display = "block";
        }
    </script>
{% endblock %}
