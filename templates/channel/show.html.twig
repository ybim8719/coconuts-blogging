{% extends 'base.html.twig' %}

{% block title %} {% if channel is not null %} {{ channel.title }} {% endif %} {% endblock %}

{% block body %}
    <div class="coconuts-story-container">
        {% if channel is not null %}
            <div>
                <h3>{{ channel.title }}</h3>
                <div class="chapeau">{{ channel.description }}</div>
                <div class="secondary-info">
                    {{ channel.getNbOfArticles }} articles publiés
                    {{ channel.getNbOfChannelSubscriptions }} abonnés
                    <span class="label-stylay label-green label-rikiki">Abonné</span>
                </div>
            </div>
            <div class="">
                <button class="tab-button coconuts-active" id="articles" data-type="channel-profile">Articles</button>
                <button class="tab-button coconuts-inactive" id="writers" data-type="channel-profile" >Auteurs</button>
                <button class="tab-button coconuts-inactive" id="subscribers" data-type="channel-profile">Membres</button>
                <button class="tab-button coconuts-inactive" id="subscription-requests" data-type="channel-profile">Demandes</button>
            </div>

            <div id="articles" data-type="channel-profile">
                {% if articles is not null %}
                    {% for article in articles %}
                        {% set hasBookmark = false %}
                        {% set hasLiked = false %}
                        {% if app.user is not null %}
                            {% if app.user.hasBookmarkedArticle(article) == true %}
                                {% set hasBookmark = true %}
                            {% endif %}
                            {% if app.user.hasLikedArticle(article) == true %}
                                {% set hasLiked = true %}
                            {% endif %}
                        {% endif %}

                        {% include '/article/partials/article_medium_size_block.html.twig' with {'article': article, 'hasLiked': hasLiked, 'hasBookmark': hasBookmark} %}
                    {% endfor %}
                {% else %}
                    <div class="border-stylay ">
                        Pas d'article pour ce membre.
                    </div>
                {% endif %}
            </div>

            <div id="writers" data-type="channel-profile">
                {% if writersWithRelatedArticles is not null %}
                    {% for writer in writersWithRelatedArticles %}
                        {% include 'user/partial/user_wih_articles_short_table_item.html.twig'
                            with {'writer': writer[0], 'articlesOfWriter': writer.articles, 'createdAt':  writer.createdAt} %}
                    {% endfor %}
                {% else %}
                    <div class="border-stylay ">
                        Pas d'article pour ce membre.
                    </div>
                {% endif %}
            </div>
            <div id="subscribers" data-type="channel-profile">
                {% if subscribers is not null %}
                    {% for subscriber in subscribers %}
                        {% include 'user/partial/user_wih_articles_short_table_item.html.twig'
                            with {'writer': subscriber[0], 'isAuthor': subscriber.isAuthor, 'createdAt':
                            subscriber.createdAt, 'isAdmin' : subscriber.isAdmin, 'nbOfArticles' : subscriber.nbOfArticles } %}
                    {% endfor %}
                {% else %}
                    <div class="border-stylay ">
                        Pas d'article pour ce membre.
                    </div>
                {% endif %}
            </div>
            <div id="subscription-requests" data-type="channel-profile">
                {% if requests is not empty %}
                    <p>Demandes en attente</p>
                    {% if requests.pending is not empty %}
                        {% for user in requests.pending %}
                            {% include 'user/partial/user_wih_articles_short_table_item.html.twig' with {'user': user} %}
                        {% endfor %}
                    {% else %}
                        <p> Pas de demandes en attente</p>
                    {% endif %}

                    <p>Demandes refusées</p>
                    {% if requests.refused is not empty %}
                        {% for user in requests.refused %}
                            {% include 'user/partial/user_wih_articles_short_table_item.html.twig' with {'user': user} %}
                        {% endfor %}
                    {% else %}
                        <p> Aucune demande acceptée n'a été retrouvée </p>
                    {% endif %}
                {% else %}
                    <div class="border-stylay ">
                        Pas de demande refusée retrouvée.
                    </div>
                {% endif %}
            </div>
        {% else %}
            No info on this channel
        {% endif %}
    </div>

{% endblock %}